# TODO – 2025-11-09

## Clarify ModeManager Plugin Activation Flow

**User Question:**
> Is the repeated activation block in `mode_manager._setup_spectra_switch` really necessary for every plugin? Shouldn’t we have a helper or delegate this to the plugin instead of keeping that code in ModeManager?

**Current Answer:**
- Spectra (and any ModuleBase plugin without a `device.<name>` module) must call `cc_registry.load_from_module` before `init_page()` so the StateManager registers knobs under the correct namespace. Vibrato/VK8M call `load_from_device(...)` and get that for free.
- ModeManager owns the routing because it tracks UI modes and hardware ownership. The repeated block ensures: `set_active_module → load registry → init_page → unit_router.load_module` before hydration, preventing quota logs like `[STATE_MGR] ... Knob QUADRAVERB:xxxx not found`.
- The logging updates in `module_base` now autowire `sm_source_name`/`sm_param_id` after dials are created, but the registry loading step still has to happen before `init_page()` runs.
- Long term we should add a helper/wrapper (e.g., `module_base.activate_module(ModuleClass, header_text)`) so new plugins don’t need custom branches in ModeManager. Documentation and quick-start guides will need a matching update once that helper exists.

**Implementation Notes for Future Task:**
1. Design a wrapper that performs:
   ```python
   module_base.set_active_module(ModuleCls)
   cc_registry.load_from_module(ModuleCls.MODULE_ID, ModuleCls.REGISTRY)
   module_base.init_page()
   unit_router.load_module(ModuleCls.MODULE_ID, module_base.handle_hw_dial)
   ```
   and handles error logging in one place.
2. Update all `_setup_<plugin>` branches in `mode_manager.py` to call the helper instead of duplicating the above logic.
3. Refresh documentation (`docs/plugins/*.md`) once the helper is live so new plugins use the simplified entry point.
4. Confirm log breadcrumbs (`showlog.debug("*[")`) remain intact after refactoring.
